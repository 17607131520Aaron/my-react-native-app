# 实现计划

- [x] 1. 创建项目结构和类型定义
  - [x] 1.1 创建 ScanCode 组件目录结构
    - 创建 `src/components/ScanCode/` 目录
    - 创建 `index.ts`、`types.ts`、`constants.ts` 文件
    - _需求: 1.1, 2.1_
  - [x] 1.2 定义 TypeScript 类型和接口
    - 定义 `IScanCodeProps`、`IScanResult`、`IScanArea`、`CodeType` 等类型
    - 定义 `IUseScanCodeLogicOptions`、`IUseScanCodeLogicReturn` 接口
    - _需求: 2.1, 8.1_
  - [x] 1.3 定义常量和默认配置
    - 定义默认条码格式列表
    - 定义条码类型映射（组件类型到 CameraKit 类型）
    - 定义默认超时时间、扫码间隔等常量
    - _需求: 2.3_

- [x] 2. 实现过滤工具函数
  - [x] 2.1 实现区域过滤函数 `filterByArea`
    - 根据扫描区域配置过滤条码位置
    - 支持容差配置
    - _需求: 3.1, 3.2_
  - [x] 2.2 实现距离排序函数 `sortByDistance`
    - 计算条码中心点到扫描区域中心点的欧几里得距离
    - 按距离从小到大排序
    - _需求: 3.3_
  - [x] 2.3 实现正则过滤函数 `filterByPatterns`
    - 实现排除过滤逻辑
    - 实现包含过滤逻辑
    - 确保先排除后包含的执行顺序
    - _需求: 4.1, 4.2, 4.3_

- [x] 3. 实现缓存管理模块
  - [x] 3.1 实现缓存管理 Hook `useCacheManager`
    - 实现 `addToCache` 方法
    - 实现 `isInCache` 方法
    - 实现 `removeFromCache` 方法
    - 实现 `clearCache` 方法
    - 实现超时自动清除逻辑
    - _需求: 5.1, 5.3, 5.4, 5.5_

- [x] 4. 实现核心扫码逻辑 Hook
  - [x] 4.1 实现 `useScanCodeLogic` Hook 基础结构
    - 定义状态：isScanning、flashlightOn
    - 实现 pauseScanning、resumeScanning 方法
    - 实现 toggleFlashlight 方法
    - _需求: 6.2, 6.3, 7.4_
  - [x] 4.2 实现扫码结果处理逻辑
    - 集成区域过滤
    - 集成正则过滤
    - 集成缓存检查
    - 实现扫码间隔控制
    - _需求: 3.1, 3.2, 3.3, 4.1, 4.2, 5.2, 6.1, 6.4_
  - [x] 4.3 实现扫码结果回调
    - 构建 IScanResult 对象（包含 data、type、timestamp）
    - 调用 onCodeScanned 回调
    - 调用 onMultipleCodesScanned 回调（多码模式）
    - 调用 onCachedCodeScanned 回调（缓存命中）
    - _需求: 8.1, 8.2_
  - [x] 4.4 实现扫码超时逻辑
    - 设置超时定时器
    - 超时时调用 onScanTimeout 回调
    - _需求: 8.3_

- [x] 5. 实现生命周期管理
  - [x] 5.1 实现页面焦点监听
    - 使用 useFocusEffect 监听页面焦点
    - 失焦时暂停扫码
    - 获焦时恢复扫码
    - _需求: 10.1, 10.2_
  - [x] 5.2 实现应用状态监听
    - 使用 AppState 监听应用前后台切换
    - 进入后台时暂停扫码并关闭闪光灯
    - 返回前台时恢复扫码
    - _需求: 10.3, 10.4_
  - [x] 5.3 实现 isActive 属性控制
    - 监听 isActive 属性变化
    - isActive 为 false 时停止相机预览
    - isActive 为 true 时恢复相机预览
    - _需求: 10.5, 10.6_

- [x] 6. 实现 ScanCode 主组件
  - [x] 6.1 实现组件基础结构
    - 集成 useScanCodeLogic Hook
    - 集成 usePermissions 请求相机权限
    - 处理权限拒绝和相机错误
    - _需求: 1.1, 1.2, 1.3, 1.4_
  - [x] 6.2 集成 react-native-camera-kit
    - 配置 CameraKitCamera 组件
    - 传递条码格式配置
    - 处理 onReadCode 事件
    - _需求: 2.2_
  - [x] 6.3 实现震动反馈
    - 扫码成功时触发震动
    - 支持 enableVibration 属性控制
    - _需求: 7.1_
  - [x] 6.4 实现扫描动画组件
    - 创建扫描线动画
    - 支持 showScanAnimation 属性控制
    - _需求: 7.3_
  - [x] 6.5 实现遮罩层组件
    - 渲染扫描区域外的遮罩
    - 支持 maskColor 属性自定义颜色
    - _需求: 9.2_
  - [x] 6.6 实现样式和子组件支持
    - 应用 style 属性到容器
    - 渲染 children 子组件
    - _需求: 9.1, 9.3_

- [x] 7. 实现资源清理
  - [x] 7.1 实现组件卸载清理逻辑
    - 关闭闪光灯
    - 清除所有定时器
    - 清空条码缓存
    - 移除应用状态监听器
    - _需求: 11.1, 11.2, 11.3, 11.4_

- [x] 8. 导出和集成
  - [x] 8.1 创建组件导出文件
    - 从 `src/components/ScanCode/index.ts` 导出组件和类型
    - 更新 `src/components/shared/index.ts` 添加导出
    - _需求: 1.1_
